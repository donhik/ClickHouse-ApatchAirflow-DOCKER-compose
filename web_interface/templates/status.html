{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã{% endblock %}

{% block content %}
<div class="dashboard">
    <h2>‚öôÔ∏è –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
    
    <div class="stats-grid">
        <!-- ClickHouse Status -->
        <div class="stat-card">
            <h3>ClickHouse</h3>
            <p class="stat-number {% if system_info.clickhouse_status == 'healthy' %}success{% else %}error{% endif %}">
                {{ system_info.clickhouse_status }}
            </p>
            <p class="stat-subtitle">–°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
        </div>
        
        <!-- Airflow Status -->
        <div class="stat-card">
            <h3>Airflow</h3>
            <p class="stat-number {% if system_info.airflow_status == 'healthy' %}success{% else %}error{% endif %}">
                {{ system_info.airflow_status }}
            </p>
            <p class="stat-subtitle">–°—Ç–∞—Ç—É—Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</p>
        </div>
        
        <!-- Database Size -->
        <div class="stat-card">
            <h3>–†–∞–∑–º–µ—Ä –ë–î</h3>
            <p class="stat-number">{{ system_info.database_size }}</p>
            <p class="stat-subtitle">–ó–∞–Ω–∏–º–∞–µ–º–æ–µ –º–µ—Å—Ç–æ</p>
        </div>
        
        <!-- Table Count -->
        <div class="stat-card">
            <h3>–¢–∞–±–ª–∏—Ü –≤ –ë–î</h3>
            <p class="stat-number">{{ system_info.table_count }}</p>
            <p class="stat-subtitle">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü</p>
        </div>
    </div>
    
    <!-- System Information -->
    <div class="section" style="margin-top: 40px;">
        <h3>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h3>
        
        <div class="system-info-grid">
            <div class="system-info-item">
                <h4>ClickHouse Server</h4>
                <p><strong>Host:</strong> clickhouse-server</p>
                <p><strong>Port:</strong> 9000</p>
                <p><strong>Database:</strong> hh_data</p>
            </div>
            
            <div class="system-info-item">
                <h4>Airflow</h4>
                <p><strong>Web Server:</strong> <a href="http://localhost:8080" target="_blank">http://localhost:8080</a></p>
                <p><strong>Scheduler:</strong> {{ 'Running' if system_info.airflow_status == 'healthy' else 'Stopped' }}</p>
            </div>
            
            <div class="system-info-item">
                <h4>Web Interface</h4>
                <p><strong>Host:</strong> 0.0.0.0</p>
                <p><strong>Port:</strong> 5000</p>
                <p><strong>Framework:</strong> Flask</p>
            </div>
            
            <div class="system-info-item">
                <h4>ClickHouse UI</h4>
                <p><strong>URL:</strong> <a href="http://localhost:8123" target="_blank">http://localhost:8123</a></p>
                <p><strong>User:</strong> admin</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Links -->
    <div class="section" style="margin-top: 40px;">
        <h3>üîó –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏</h3>
        
        <div class="quick-links-grid">
            <a href="http://localhost:8080" target="_blank" class="quick-link-card">
                <div class="quick-link-icon">‚úàÔ∏è</div>
                <div class="quick-link-title">Airflow UI</div>
                <div class="quick-link-desc">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DAG</div>
            </a>
            
            <a href="http://localhost:8123" target="_blank" class="quick-link-card">
                <div class="quick-link-icon">üìä</div>
                <div class="quick-link-title">ClickHouse UI</div>
                <div class="quick-link-desc">SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</div>
            </a>
            
            <a href="{{ url_for('index') }}" class="quick-link-card">
                <div class="quick-link-icon">üè†</div>
                <div class="quick-link-title">–ì–ª–∞–≤–Ω–∞—è</div>
                <div class="quick-link-desc">–î–∞—à–±–æ—Ä–¥ –≤–∞–∫–∞–Ω—Å–∏–π</div>
            </a>
            
            <a href="{{ url_for('analytics') }}" class="quick-link-card">
                <div class="quick-link-icon">üìà</div>
                <div class="quick-link-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</div>
                <div class="quick-link-desc">–ì—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã</div>
            </a>
            
            <a href="{{ url_for('query') }}" class="quick-link-card">
                <div class="quick-link-icon">üîç</div>
                <div class="quick-link-title">SQL –ó–∞–ø—Ä–æ—Å—ã</div>
                <div class="quick-link-desc">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</div>
            </a>
        </div>
    </div>
    
    <div class="quick-actions" style="margin-top: 40px;">
        <a href="{{ url_for('index') }}" class="btn-primary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <button class="btn-secondary" onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
// setInterval(() => {
//     location.reload();
// }, 30000);
</script>

<style>
.system-info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.system-info-item {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.system-info-item h4 {
    margin-top: 0;
    color: #495057;
    margin-bottom: 15px;
}

.system-info-item p {
    margin: 8px 0;
    font-size: 14px;
}

.system-info-item strong {
    color: #667eea;
}

.system-info-item a {
    color: #667eea;
    text-decoration: none;
}

.system-info-item a:hover {
    text-decoration: underline;
}

.quick-links-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.quick-link-card {
    display: block;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 12px;
    text-decoration: none;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
}

.quick-link-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
}

.quick-link-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.quick-link-title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 8px;
}

.quick-link-desc {
    font-size: 0.9rem;
    opacity: 0.9;
}
</style>
{% endblock %}