{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞{% endblock %}

{% block content %}
<div class="dashboard">
    <h2>üìà –ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
    
    <div class="charts-grid">
        <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ -->
        <div class="chart-container">
            <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ</h3>
            <div id="salary-chart" style="height: 400px;"></div>
        </div>
        
        <!-- –£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞ -->
        <div class="chart-container">
            <h3>–£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞</h3>
            <div id="experience-chart" style="height: 400px;"></div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã -->
        <div class="chart-container">
            <h3>–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã</h3>
            <div id="schedule-chart" style="height: 400px;"></div>
        </div>
        
        <!-- –¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ -->
        <div class="chart-container">
            <h3>–¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏</h3>
            <div id="employment-chart" style="height: 400px;"></div>
        </div>
    </div>
    
    <div class="quick-actions" style="margin-top: 30px;">
        <a href="{{ url_for('index') }}" class="btn-primary">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∑–∞—Ä–ø–ª–∞—Ç–µ
    const salaryData = {{ data.salary_distribution | tojson }};
    if (salaryData && salaryData.length > 0) {
        const salaryTrace = {
            x: salaryData.map(d => d.range),
            y: salaryData.map(d => d.count),
            type: 'bar',
            marker: {color: '#667eea'},
            text: salaryData.map(d => d.count),
            textposition: 'auto'
        };
        const salaryLayout = {
            title: '',
            xaxis: {title: '–î–∏–∞–ø–∞–∑–æ–Ω –∑–∞—Ä–ø–ª–∞—Ç—ã'},
            yaxis: {title: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–∫–∞–Ω—Å–∏–π'},
            margin: {t: 30, b: 80, l: 40, r: 20},
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)'
        };
        Plotly.newPlot('salary-chart', [salaryTrace], salaryLayout);
    } else {
        document.getElementById('salary-chart').innerHTML = '<p style="color: #777; text-align: center; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    }
    
    // –£—Ä–æ–≤–µ–Ω—å –æ–ø—ã—Ç–∞
    const expData = {{ data.experience_levels | tojson }};
    if (expData && expData.length > 0) {
        const expTrace = {
            labels: expData.map(d => d.level),
            values: expData.map(d => d.count),
            type: 'pie',
            marker: {colors: ['#667eea', '#764ba2', '#f093fb', '#4facfe', '#43e97b']},
            textinfo: 'label+percent',
            hoverinfo: 'label+value'
        };
        const expLayout = {
            title: '',
            margin: {t: 30, b: 30, l: 30, r: 30},
            paper_bgcolor: 'rgba(0,0,0,0)'
        };
        Plotly.newPlot('experience-chart', [expTrace], expLayout);
    } else {
        document.getElementById('experience-chart').innerHTML = '<p style="color: #777; text-align: center; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    }
    
    // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã
    const scheduleData = {{ data.schedule_types | tojson }};
    if (scheduleData && scheduleData.length > 0) {
        const scheduleTrace = {
            x: scheduleData.map(d => d.type),
            y: scheduleData.map(d => d.count),
            type: 'bar',
            marker: {color: '#764ba2'},
            text: scheduleData.map(d => d.count),
            textposition: 'auto'
        };
        const scheduleLayout = {
            title: '',
            xaxis: {title: '–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞', tickangle: -45},
            yaxis: {title: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'},
            margin: {t: 30, b: 100, l: 40, r: 20},
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)'
        };
        Plotly.newPlot('schedule-chart', [scheduleTrace], scheduleLayout);
    } else {
        document.getElementById('schedule-chart').innerHTML = '<p style="color: #777; text-align: center; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    }
    
    // –¢–∏–ø –∑–∞–Ω—è—Ç–æ—Å—Ç–∏
    const employmentData = {{ data.employment_types | tojson }};
    if (employmentData && employmentData.length > 0) {
        const employmentTrace = {
            labels: employmentData.map(d => d.type),
            values: employmentData.map(d => d.count),
            type: 'pie',
            marker: {colors: ['#4facfe', '#43e97b', '#fa709a', '#f093fb']},
            textinfo: 'label+percent',
            hoverinfo: 'label+value'
        };
        const employmentLayout = {
            title: '',
            margin: {t: 30, b: 30, l: 30, r: 30},
            paper_bgcolor: 'rgba(0,0,0,0)'
        };
        Plotly.newPlot('employment-chart', [employmentTrace], employmentLayout);
    } else {
        document.getElementById('employment-chart').innerHTML = '<p style="color: #777; text-align: center; padding: 50px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>';
    }
</script>
{% endblock %}