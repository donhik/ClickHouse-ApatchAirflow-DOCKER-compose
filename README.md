# ๐ VacancyFlow: ะะฝะฐะปะธัะธะบะฐ ะฒะฐะบะฐะฝัะธะน hh.ru ะฝะฐ ััะตะบะต Airflow + ClickHouse

**ะะพัะพะฒะพะต ัะตัะตะฝะธะต ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ะผะพะฝะธัะพัะธะฝะณะฐ ััะฝะบะฐ ัััะดะฐ** โ ัะพะฑะธัะฐะตั ะฒะฐะบะฐะฝัะธะธ ั HeadHunter ะฟะพ ัััะผ ะณะพัะพะดะฐะผ ะะพััะธะธ (ะะพัะบะฒะฐ, ะัะฐัะฝะพะดะฐั, ะะพะปะณะพะณัะฐะด), ะพะฑัะฐะฑะฐััะฒะฐะตั ะดะฐะฝะฝัะต ะบะฐะถะดัะต 4 ัะฐัะฐ ะธ ะฒะธะทัะฐะปะธะทะธััะตั ัะตะทัะปััะฐัั ะฒ ัะดะพะฑะฝะพะผ ะฒะตะฑ-ะธะฝัะตััะตะนัะต.

## โจ ะะปััะตะฒัะต ะฒะพะทะผะพะถะฝะพััะธ

- **ะะฒัะพะผะฐัะธัะตัะบะธะน ัะฑะพั ะดะฐะฝะฝัั** โ DAG ะฒ Apache Airflow ะทะฐะฟััะบะฐะตััั ะฟะพ ัะฐัะฟะธัะฐะฝะธั (4 ัะฐัะฐ)
- **ะััะพะบะพะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพะต ััะฐะฝะธะปะธัะต** โ ClickHouse ะดะปั ะฑััััะพะน ะฐะฝะฐะปะธัะธะบะธ ะฑะพะปััะธั ะพะฑััะผะพะฒ ะดะฐะฝะฝัั
- **ะะฝัะตัะฐะบัะธะฒะฝัะน ะดะฐัะฑะพัะด** โ ะฒะตะฑ-ะธะฝัะตััะตะนั ะฝะฐ ะฟะพััั 5001
- **ะะพัะพะฒะฐั ะธะฝััะฐััััะบัััะฐ** โ ะฟะพะปะฝะพัััั ะบะพะฝัะตะนะฝะตัะธะทะพะฒะฐะฝะฝะพะต ัะตัะตะฝะธะต ะฝะฐ Docker Compose
- **ะะฐัััะฐะฑะธััะตะผะฐั ะฐััะธัะตะบัััะฐ** โ ะปะตะณะบะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะต ะณะพัะพะดะฐ ะธ ะธััะพัะฝะธะบะธ ะดะฐะฝะฝัั

## ๐๏ธ ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ
โ   hh.ru API โโโโโโถโ   Airflow   โโโโโโถโ  ClickHouse โ
โ  (ะธััะพัะฝะธะบ) โ     โ   (DAG)     โ     โ  (ััะฐะฝะธะปะธัะต)โ
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ     โโโโโโโโฌโโโโโโโ
                                                โ
                                         โโโโโโโโผโโโโโโโ
                                         โ  Web UI     โ
                                         โ  (ะดะฐัะฑะพัะด)  โ
                                         โโโโโโโโโโโโโโโ
```

## โก ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั
- Docker Engine 20.10+
- Docker Compose 2.0+
- Git

### ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

```bash
# 1. ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/donhik/ClickHouse-ApatchAirflow-DOCKER-compose.git 
cd ClickHouse-ApatchAirflow-DOCKER-compose

# 2. ะะฐะฟัััะธัั ััะตะบ (ะฟะตัะฒัะน ะทะฐะฟััะบ ~2 ะผะธะฝััั)
docker-compose up -d

# 3. ะัะธะผะตะฝะธัั ััะตะผั ะะ
docker-compose exec -T clickhouse-server clickhouse-client \
  --user admin --password clickhouse_pass --multiquery < init_schema.sql

# 4. ะะบัะธะฒะธัะพะฒะฐัั ะธ ะทะฐะฟัััะธัั DAG
docker-compose exec airflow-webserver airflow dags unpause hh_3cities_stable
docker-compose exec airflow-webserver airflow dags trigger hh_3cities_stable

# 5. ะัะบัััั ะดะฐัะฑะพัะด (ัะตัะตะท 2-3 ะผะธะฝััั ะดะฐะฝะฝัะต ะฟะพัะฒัััั)
start http://localhost:5001
```

## ๐ฅ๏ธ ะะพัััะฟะฝัะต ะธะฝัะตััะตะนัั

| ะกะตัะฒะธั | URL | ะฃัััะฝัะต ะดะฐะฝะฝัะต | ะะฟะธัะฐะฝะธะต |
|--------|-----|----------------|----------|
| ๐ ะะตะฑ-ะดะฐัะฑะพัะด | http://localhost:5001 | โ | ะะฝัะตััะตะนั ะฟัะพัะผะพััะฐ ะฒะฐะบะฐะฝัะธะน ั ัะธะปัััะฐะผะธ |
| ๐ค Airflow UI | http://localhost:8080 | admin / admin | ะะพะฝะธัะพัะธะฝะณ ะธ ัะฟัะฐะฒะปะตะฝะธะต DAG |
| ๐๏ธ ClickHouse | http://localhost:8123 | admin / clickhouse_pass | HTTP-ะธะฝัะตััะตะนั ะฑะฐะทั ะดะฐะฝะฝัั |

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
ClickHouse-ApatchAirflow-DOCKER-compose/
โโโ docker-compose.yml          # ะัะบะตัััะฐัะธั ะฒัะตั ัะตัะฒะธัะพะฒ
โโโ init_schema.sql             # DDL-ัะบัะธะฟัั ะดะปั ClickHouse
โโโ dags/
โ   โโโ hh_3cities_stable.py    # DAG ัะฑะพัะฐ ะดะฐะฝะฝัั (ะะพัะบะฒะฐ, ะัะฐัะฝะพะดะฐั, ะะพะปะณะพะณัะฐะด)
โโโ docs/
โ   โโโ diagram.png             # ะกัะตะผะฐ ะฐััะธัะตะบัััั
โโโ README.md                   # ะะพะบัะผะตะฝัะฐัะธั
โโโ .gitignore
```

## ๐ฏ ะัะฟะพะปัะทัะตะผัะต ัะตัะฝะพะปะพะณะธะธ

| ะขะตัะฝะพะปะพะณะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|------------|------------|
| Apache Airflow | ะัะบะตัััะฐัะธั ETL-ะฟัะพัะตััะพะฒ ะธ ะฟะปะฐะฝะธัะพะฒะฐะฝะธะต ะทะฐะดะฐั |
| ClickHouse | ะะพะปะพะฝะพัะฝะฐั ะฐะฝะฐะปะธัะธัะตัะบะฐั ะกะฃะะ ะดะปั ััะฐะฝะตะฝะธั ะฒะฐะบะฐะฝัะธะน |
| Docker & Docker Compose | ะะพะฝัะตะนะฝะตัะธะทะฐัะธั ะธ ัะฟัะฐะฒะปะตะฝะธะต ะธะฝััะฐััััะบัััะพะน |
| Python 3.9+ | ะะฐะทัะฐะฑะพัะบะฐ DAG ะธ ะพะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั |
| HeadHunter API | ะััะพัะฝะธะบ ะดะฐะฝะฝัั ะพ ะฒะฐะบะฐะฝัะธัั |

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### ะะทะผะตะฝะตะฝะธะต ัะฐัะฟะธัะฐะฝะธั ัะฑะพัะฐ ะดะฐะฝะฝัั

ะััะตะดะฐะบัะธััะนัะต DAG ะฒ ัะฐะนะปะต `dags/hh_3cities_stable.py`:

```python
# ะะฐัะฐะผะตัั schedule_interval ะพัะฒะตัะฐะตั ะทะฐ ะฟะตัะธะพะดะธัะฝะพััั
# ะะพ ัะผะพะปัะฐะฝะธั: ะบะฐะถะดัะต 4 ัะฐัะฐ
schedule_interval='0 */4 * * *',  # cron-ะฒััะฐะถะตะฝะธะต
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ะณะพัะพะดะพะฒ

ะ DAG ะฝะฐะนะดะธัะต ัะฟะธัะพะบ ะณะพัะพะดะพะฒ ะธ ะดะพะฑะฐะฒััะต ะฝัะถะฝัะต:

```python
CITIES = {
    'ะะพัะบะฒะฐ': 1,
    'ะัะฐัะฝะพะดะฐั': 53,
    'ะะพะปะณะพะณัะฐะด': 24,
    # ะะพะฑะฐะฒััะต ะฝะพะฒัะน ะณะพัะพะด: 'ะะฐะทะฒะฐะฝะธะต': ID_ะณะพัะพะดะฐ
}
```

ID ะณะพัะพะดะฐ ะผะพะถะฝะพ ะฝะฐะนัะธ ะฒ [ะดะพะบัะผะตะฝัะฐัะธะธ HH API](https://github.com/hhru/api/blob/master/docs/areas.md)

## ๐ก ะะพะทะผะพะถะฝะพััะธ ะบะฐััะพะผะธะทะฐัะธะธ

- [ ] ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ะณะพัะพะดะพะฒ ัะตัะตะท ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต DAG
- [ ] ะะทะผะตะฝะตะฝะธะต ัะฐัะฟะธัะฐะฝะธั ัะฑะพัะฐ ะดะฐะฝะฝัั
- [ ] ะะฐััะธัะตะฝะธะต ััะตะผั ะดะฐะฝะฝัั ะดะปั ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะฟะพะปะตะน
- [ ] ะะพะฑะฐะฒะปะตะฝะธะต ะฐะฒัะพัะธะทะฐัะธะธ ะฒ ะฒะตะฑ-ะธะฝัะตััะตะนั

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฝะตะฟะพะปะฐะดะพะบ

### ะะฐะฝะฝัะต ะฝะต ะฟะพัะฒะปััััั ะฒ ะดะฐัะฑะพัะดะต

ะัะพะฒะตัััะต ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ:
```bash
docker-compose ps
```

ะัะพะฒะตัััะต ะปะพะณะธ Airflow:
```bash
docker-compose logs airflow-webserver
```

ะฃะฑะตะดะธัะตัั, ััะพ DAG ะฒัะฟะพะปะฝะธะปัั ััะฟะตัะฝะพ ะฒ ะธะฝัะตััะตะนัะต Airflow (http://localhost:8080)

### ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ ClickHouse

```bash
# ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั ClickHouse
docker-compose exec clickhouse-server clickhouse-client --user admin --password clickhouse_pass --query "SELECT 1"
```


## ๐ฅ ะะปั ะบะพะณะพ ััะพั ะฟัะพะตะบั

| ะะพะปั | ะัะธะผะตะฝะตะฝะธะต |
|------|------------|
| HR-ะฐะฝะฐะปะธัะธะบะธ | ะะทััะตะฝะธะต ััะฝะบะฐ ัััะดะฐ, ะฐะฝะฐะปะธะท ะทะฐัะฟะปะฐัะฝัั ะฒะธะปะพะบ |
| Data Engineer'ั | ะะทััะตะฝะธะต Airflow ะธ ClickHouse ะฝะฐ ะฟัะฐะบัะธะบะต |
| ะะฐะทัะฐะฑะพััะธะบะธ | ะะฐะทะฐ ะดะปั ัะพะทะดะฐะฝะธั ัะพะฑััะฒะตะฝะฝัั ETL-ัะตัะตะฝะธะน |
| ะะตะบัััะตัั | ะะพะฝะธัะพัะธะฝะณ ะฐะบัะธะฒะฝะพััะธ ัะฐะฑะพัะพะดะฐัะตะปะตะน |

---
